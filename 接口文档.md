# 一、接口总体约定

## 1 请求基础约定

### (1) 接口风格 

全部采用 REST 风格，统一使用 JSON 进行请求体和响应体交互。

### (2) URL 前缀示例

- 用户端接口前缀：`/api`
- 管理端接口前缀：`/api/admin`

### (3) 认证方式

- 登录成功后返回 token，前端后续请求统一通过请求头携带`Authorization: Bearer {token}`
- Token 的解析细则与失败处理规则见 2 前端硬约束与统一返回结构

## 2 前端硬约束与统一返回结构

### (1) 统一返回结构

所有接口必须返回：

```json
{
  "code": 0,
  "message": "成功",
  "data": {}
}
```

- code 仅当为 0 时表示成功
- code 非 0 表示失败
- 字段名 code message data 不得修改
- 实际业务数据必须放在 data 中
- 对于无业务数据的成功响应，data 可为 null，但字段必须存在

### (2) ID 必须序列化为字符串

为避免前端 JavaScript 处理长整型 ID 时精度丢失：

- 所有长整型主键输出时必须转为字符串
- 覆盖用户 商品 分类 购物车 订单及其明细等所有嵌套对象
- 推荐使用全局序列化策略，并在 DTO 中将 id 相关字段统一定义为 String

### (3) 认证 Token 格式

前端固定携带`Authorization: Bearer {token}`

后端仅解析该 Header，剥离 Bearer 与空格后的字符串作为 token

未提供 Token、Token 非法或已过期时统一返回 code=40002

### (4) CORS 跨域配置

- 开发环境默认通过 Vite 代理解决跨域问题，后端不强制要求配置 CORS。
- 上线环境如使用 Nginx 反向代理或网关统一转发，也无需在业务服务额外配置。
- 如需本地直连调试，可参考以下示例配置
  - 允许来源 `http://localhost:5173`
  - 允许方法 GET POST PUT DELETE OPTIONS
  - 允许请求头 `Authorization Content-Type`
  - 预检请求必须放行

### (5) 关键参数命名约定

以下参数名已在前端写死，后端不得更改

- 分页参数 pageNum pageSize
- 商品查询 categoryId keyword
- 购物车操作 productId quantity
- 订单创建 cartItemIds addressId
  - 立即购买模式额外使用 productId 与 quantity，字段名同本约定，不得更改

### (6) 接口兼容性声明

- 已对接前端的接口后续迭代中不得修改现有字段名 参数名 路径 枚举值含义
- 可以新增字段但不得删除或改变已存在字段的语义
- 如需破坏性调整，应新增版本路径

## 3 分页参数约定

请求侧统一使用

- `pageNum` 当前页，从 1 开始
- `pageSize` 每页数量（默认为10）

响应侧统一返回

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "total": 100,
    "list": [],
    "pageNum": 1,
    "pageSize": 10
  }
}
```

## 4 HTTP 状态码与业务错误码约定

### (1) HTTP 状态码

- 正常业务调用统一返回 HTTP 200
- 业务成功失败由 code 决定

### (2) 常用业务错误码

- 40001 参数校验失败
- 40002 未登录或登录已过期
- 40003 无权限
- 40004 库存不足
- 40400 资源不存在
- 50000 系统内部错误

失败响应必须为统一结构

```json
{
  "code": 40002,
  "message": "登录已过期，请重新登录",
  "data": null
}
```

## 5 时间与金额字段统一约定

### (1) 时间

- 所有对外时间字段统一使用 `yyyy-MM-dd HH:mm:ss`

### (2) 金额

- 所有金额字段单位为元。
- 接口响应数据类型必须为 **Number** (例如 `3999` 或 `3999.50`)，**禁止**返回字符串类型（例如 `"3999.00"`）
- 后端使用 BigDecimal 进行金额计算，向前端返回数值。
- 前端负责界面展示格式化（例如保留两位小数）

# 二、通用文件上传接口

为支持用户头像及商品图片上传，提供统一上传接口。

(1) 上传图片文件

- 接口名称：文件上传
- 方法：POST
- 路径：`/api/upload`
- 是否需要登录：否（用户头像、个人中心等场景）或管理员登录（商品图片上传），可在后端通过角色区分
- 请求方式：`multipart/form-data`

请求示例（表单字段）

- 字段名：`file`
- 类型：文件（单文件上传）

说明

- 后端使用 MultipartFile 接收上传文件，将其保存到本地磁盘指定目录（例如 `static/images/`）
- 通过静态资源映射将该目录暴露为 HTTP 可访问路径（例如 `/images/**`）
- 允许返回**相对路径**（例如 `/images/product/p1.jpg`）。
- 前端项目约定：若使用相对路径，默认通过代理指向后端静态资源目录。

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "url": "/images/2025/12/01/abc.jpg",
    "fullUrl": "http://localhost:8080/images/2025/12/01/abc.jpg",
    "originalFilename": "abc.jpg"
  }
}
```

字段说明

- `url` 图片相对访问路径，建议在业务字段中使用该值存储。
- `fullUrl` 图片完整访问地址，前端可直接用于展示。
- `originalFilename` 原始文件名。

对外返回规则

- 业务表中建议存储 `url`。
- 若数据库中存储的是相对路径 `url`，后端在响应组装阶段应统一补全协议 域名 与访问前缀后再返回。

后续接口字段约定

- 后续接口中的 `avatar`、`mainImage`、`productImage`、`imageList` 等图片相关字段
  请求侧允许传入本接口返回的 `url` 或 `fullUrl`。
- 响应侧必须返回完整 URL。
- 数据库可存相对 url，响应组装时由后端补全。
- 上传接口返回 url 仅用于前端提交与后端持久化的中间形态，业务查询类接口的图片字段不得直接对外返回该相对值

# 三、用户端接口

## 1 账户与认证模块

### (1) 用户注册

- 接口名称：用户注册
- 方法：POST
- 路径：`/api/auth/register`
- 是否需要登录：否

请求体示例

```json
{
  "username": "tom",
  "password": "123456",
  "nickname": "hk",
  "avatar": "http://localhost:8080/images/avatar/avatar1.jpg"
}
```

字段说明

- `username` 登录账号，必填，需校验唯一
- `password` 登录密码，必填，将使用 BCrypt 加密存储
- `nickname` 昵称，必填
- `avatar` 头像地址字符串，必填

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "userId": "1"
  }
}
```

### (2) 用户登录

- 接口名称：用户登录
- 方法：POST
- 路径：`/api/auth/login`
- 是否需要登录：否

请求体

```json
{
  "username": "tom",
  "password": "123456"
}
```

响应体

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "token": "xxxx.yyyy.zzzz",
    "expireAt": "2025-12-31 12:00:00",
    "user": {
      "id": "1",
      "username": "tom",
      "nickname": "hk",
      "avatar": "http://localhost:8080/images/avatar/avatar1.jpg"
    }
  }
}
```

### (3) 用户退出登录

- 接口名称：退出登录
- 方法：POST
- 路径：`/api/auth/logout`
- 是否需要登录：是

说明

- 如果使用 JWT，可以在服务端维护黑名单或刷新令牌机制
- 如果使用 Redis 存储登录态，则删除 Redis 中的会话

响应

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

### (4) 获取当前登录用户信息

- 接口名称：获取当前用户信息
- 方法：GET
- 路径：`/api/auth/me`
- 是否需要登录：是

响应

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "id": "1",
    "username": "tom",
    "nickname": "陶琦",
    "avatar": "http://localhost:8080/images/avatar/avatar1.jpg",
    "role": "USER"
  }
}
```

## 2 商品浏览与搜索模块

### (1) 获取商品分类树

- 接口名称：获取商品分类树
- 方法：GET
- 路径：`/api/categories/tree`
- 是否需要登录：否

说明

- 返回分类树结构，业务上约定仅支持两级分类（一级分类和二级分类）。`parentId` 为 `"0"` 表示一级分类，该分类的 `children` 为二级分类列表；统一返回 children 字段，二级分类 children 为 []。

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": [
    {
      "id": "1",
      "name": "手机数码",
      "parentId": "0",
      "children": [
        {
          "id": "2",
          "name": "手机",
          "parentId": "1",
          "children": []
        }
      ]
    }
  ]
}
```

### (2) 分页查询商品列表

- 接口名称：商品列表查询
- 方法：GET
- 路径：`/api/products`
- 是否需要登录：否

请求参数

- `categoryId` 商品分类编号，可选。若传入的是二级分类ID，则只查询该二级分类下的商品；若传入的是一级分类ID，后端应自动包含该一级分类下所有二级分类的商品进行查询，从而支持前端在点击一级分类时直接看到该类目下所有商品。
- `keyword` 关键字搜索，可选，对商品标题、关键字字段模糊匹配
- `sortField` 排序字段，可选，枚举
  - `price` 价格
  - `createTime` 上架时间
- `sortOrder` 排序方式，可选，`asc` 或 `desc`
- `pageNum` 页码，必填
- `pageSize` 每页数量，必填

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "total": 120,
    "list": [
      {
        "id": "1001",
        "title": "某品牌手机",
        "subTitle": "八核处理器 8G 内存",
        "mainImage": "http://localhost:8080/images/product/p1.jpg",
        "price": 3999,
        "stock": 100,
        "categoryId": "2"
      }
    ],
    "pageNum": 1,
    "pageSize": 10
  }
}
```

### (3) 商品详情

- 接口名称：商品详情查询
- 方法：GET
- 路径：`/api/products/{id}`
- 是否需要登录：否

路径参数

- `id` 商品编号（字符串）

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "id": "1001",
    "title": "某品牌手机",
    "subTitle": "八核处理器 8G 内存",
    "description": "商品详情富文本或简单描述",
    "price": 3999,
    "stock": 100,
    "categoryId": "2",
    "images": [
      "http://localhost:8080/images/product/p1.jpg",
      "http://localhost:8080/images/product/p2.jpg"
    ],
    "createTime": "2025-12-01 10:00:00"
  }
}
```

## 3 购物车模块

数据暂存在数据库，将用户标识与购物车记录进行绑定。

### (1) 添加商品到购物车

- 接口名称：添加购物车
- 方法：POST
- 路径：`/api/cart/items`
- 是否需要登录：是

请求体

```json
{
  "productId": "1001",
  "quantity": 2
}
```

响应

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "cartItemId": "10"
  }
}
```

### (2) 修改购物车中商品数量

- 接口名称：修改购物车商品数量
- 方法：PUT
- 路径：`/api/cart/items/{cartItemId}`
- 是否需要登录：是

路径参数

- `cartItemId` 购物车条目 ID（字符串）

请求体

```json
{
  "quantity": 3
}
```

响应（返回更新后的购物车整体信息，方便前端直接刷新页面）

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "items": [
      {
        "cartItemId": "10",
        "productId": "1001",
        "productTitle": "某品牌手机",
        "productImage": "http://localhost:8080/images/product/p1.jpg",
        "price": 3999,
        "quantity": 3,
        "subtotalAmount": 11997
      }
    ],
    "totalQuantity": 3,
    "totalAmount": 11997
  }
}
```

说明

- 修改数量后，后端重新计算每条商品小计金额、总数量和总金额，一并返回。
- 修改购物车商品数量时，后端必须校验该商品当前库存数量。如果请求的 quantity 大于当前可用库存，接口应返回失败，不更新购物车数量。
- 库存不足场景可返回业务错误码（例如 40004），并在 message 中提示“库存不足”或类似信息，前端据此给出友好提示。

```json
{
  "code": 40004,
  "message": "库存不足",
  "data": {
    "availableStock": 2
  }
}
```

### (3) 删除购物车记录

单条删除

- 方法：DELETE
- 路径：`/api/cart/items/{cartItemId}`

批量删除

- 方法：DELETE
- 路径：`/api/cart/items`
- 是否需要登录：是

请求体：

```json
{
  "ids": ["1", "2", "3"]
}
```

响应统一

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

如运行环境不支持 DELETE 携带请求体，可兼容提供 POST /api/cart/items/delete

### (4) 查询当前用户购物车

- 接口名称：购物车列表
- 方法：GET
- 路径：`/api/cart`
- 是否需要登录：是

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "items": [
      {
        "cartItemId": "10",
        "productId": "1001",
        "productTitle": "某品牌手机",
        "productImage": "http://localhost:8080/images/product/p1.jpg",
        "price": 3999,
        "quantity": 2,
        "subtotalAmount": 7998
      }
    ],
    "totalQuantity": 2,
    "totalAmount": 7998
  }
}
```

## 4 收货地址模块

### (1) 查询收货地址列表

- 方法：GET
- 路径：`/api/addresses`
- 是否需要登录：是

响应

```json
{
  "code": 0,
  "message": "成功",
  "data": [
    {
      "id": "1",
      "receiverName": "张三",
      "receiverPhone": "13800000000",
      "province": "安徽省",
      "city": "合肥市",
      "district": "蜀山区",
      "detailAddress": "某路某号",
      "isDefault": true
    }
  ]
}
```

### (2) 新增收货地址

- 方法：POST
- 路径：`/api/addresses`

请求体

```json
{
  "receiverName": "张三",
  "receiverPhone": "13800000000",
  "province": "安徽省",
  "city": "合肥市",
  "district": "蜀山区",
  "detailAddress": "某路某号",
  "isDefault": true
}
```

### (3) 修改收货地址

- 方法：PUT
- 路径：`/api/addresses/{id}`

### (4) 删除收货地址

- 方法：DELETE
- 路径：`/api/addresses/{id}`

### (5) 设置默认收货地址

- 方法：PUT
- 路径：`/api/addresses/{id}/default`

说明

- 设置默认时，应自动取消该用户其他地址的默认标记

## 5 订单模块

订单状态枚举

- `WAIT_PAY` 待支付
- `PAID` 已支付
- `CANCELED` 已取消
- `SHIPPED` 已发货
- `COMPLETED` 已完成

### (1) 创建订单

- 接口名称：创建订单
- 方法：POST
- 路径：`/api/orders`
- 是否需要登录：是

请求体示例一（来自购物车）

```json
{
  "sourceType": "CART",
  "cartItemIds": ["10", "11"],
  "addressId": "1",
  "remark": "尽快发货"
}
```

请求体示例二（立即购买）

```json
{
  "sourceType": "BUY_NOW",
  "productId": "1001",
  "quantity": 1,
  "addressId": "1",
  "remark": "备注信息"
}
```

`sourceType=CART`或未传`sourceType`时

- cartItemIds addressId 必填

sourceType=BUY_NOW 时

- productId quantity addressId 必填

说明

- 创建订单时需要在事务中完成：
  - 校验库存
  - 扣减库存
  - 生成订单与订单明细
- 同时记录订单创建时间和支付超时时间（例如创建时间加 15 分钟）
- 订单创建时，后端需根据传入的 addressId 查询当前收货地址的完整信息，并将收货人姓名、电话、省市区与详细地址等字段以快照形式写入订单表（或订单地址表），后续订单详情接口应优先返回该快照信息，而非实时关联地址表，避免用户修改地址后影响历史订单数据。


- 购物车联动：
  - 当 `sourceType=CART` 且订单创建成功后，后端必须自动删除 `cartItemIds` 对应的购物车记录，确保购物车与订单状态一致。

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "orderId": "5001",
    "orderNo": "202512010001",
    "status": "WAIT_PAY",
    "totalAmount": 7998,
    "createTime": "2025-12-01 11:00:00",
    "expireTime": "2025-12-01 11:15:00",
    "remainingPaySeconds": 900
  }
}
```

字段说明

- `expireTime` 该订单支付超时时间
- `remainingPaySeconds` 当前剩余支付秒数，便于前端展示倒计时

### (2) 查询订单列表

- 方法：GET
- 路径：`/api/orders`
- 是否需要登录：是

请求参数

- `status` 可选，订单状态过滤
- `pageNum` 必填
- `pageSize` 必填

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "total": 1,
    "list": [
      {
        "orderId": "5001",
        "orderNo": "202512010001",
        "status": "WAIT_PAY",
        "totalAmount": 7998,
        "createTime": "2025-12-01 11:00:00",
        "payTime": null,
        "cancelTime": null,
        "expireTime": "2025-12-01 11:15:00",
        "items": [
          {
            "productId": "1001",
            "productTitle": "某品牌手机",
            "productImage": "http://localhost:8080/images/product/p1.jpg"
          },
          {
            "productId": "1002",
            "productTitle": "某品牌耳机",
            "productImage": "http://localhost:8080/images/product/p2.jpg"
          },
          {
            "productId": "1003",
            "productTitle": "数据线三件套",
            "productImage": "http://localhost:8080/images/product/p3.jpg"
          }
        ]
      }
    ],
    "pageNum": 1,
    "pageSize": 10
  }
}
```

说明

- 当订单处于 `WAIT_PAY` 且当前时间超过 `expireTime` 时，后端定时任务或延迟队列会自动将状态更新为 `CANCELED` 并回滚库存。前端刷新列表即可看到状态变化。
- 列表中的 `createTime`、`payTime`、`cancelTime`、`expireTime` 等时间字段统一由后端格式化为字符串，格式为 `yyyy-MM-dd HH:mm:ss`；`items` 字段用于列表缩略展示，建议仅返回前若干件商品的简要信息（如前 3 条）

### (3) 查询订单详情

- 方法：GET
- 路径：`/api/orders/{orderId}`

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "orderId": "5001",
    "orderNo": "202512010001",
    "status": "WAIT_PAY",
    "totalAmount": 7998,
    "createTime": "2025-12-01 11:00:00",
    "payTime": null,
    "cancelTime": null,
    "expireTime": "2025-12-01 11:15:00",
    "address": {
      "receiverName": "张三",
      "receiverPhone": "13800000000",
      "province": "安徽省",
      "city": "合肥市",
      "district": "蜀山区",
      "detailAddress": "某路某号"
    },
    "items": [
      {
        "productId": "1001",
        "productTitle": "某品牌手机",
        "productImage": "http://localhost:8080/images/product/p1.jpg",
        "price": 3999,
        "quantity": 2,
        "subtotalAmount": 7998
      }
    ]
  }
}
```

### (4) 取消订单

- 方法：PUT
- 路径：`/api/orders/{orderId}/cancel`
- 是否需要登录：是

说明

- 仅允许在状态为 `WAIT_PAY` 时取消
- 取消成功时，回滚库存
- 对于已超时自动取消的订单，可根据业务需要禁止重复取消操作或直接幂等返回

请求体可选

```json
{
  "reason": "不想要了"
}
```

### (5) 支付结果模拟

- 方法：POST
- 路径：`/api/orders/{orderId}/pay`
- 是否需要登录：是

说明

- 仅允许在状态为 `WAIT_PAY` 且当前时间未超过 `expireTime` 的订单上调用
- 调用后将订单状态变更为 `PAID`，记录 `payTime`
- 若订单已被系统自动取消，则返回相应错误码并提示“订单已超时取消，无法支付”

响应

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

# 三、管理后台接口

## 1 管理员认证模块

### (1) 管理员登录

- 方法：POST
- 路径：`/api/admin/auth/login`

请求体

```json
{
  "username": "admin",
  "password": "123456"
}
```

说明

- 可以与用户表合并，通过 `role` 字段区分
- 登录成功后返回 token，与用户端相同机制

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "token": "xxxx.yyyy.zzzz",
    "expireAt": "2025-12-31 12:00:00",
    "user": {
      "id": "1",
      "username": "admin",
      "nickname": "系统管理员",
      "avatar": "http://localhost:8080/images/avatar/admin.jpg",
      "role": "ADMIN"
    }
  }
}
```

### (2) 获取当前管理员信息

- 方法：GET
- 路径：`/api/admin/auth/me`
- 是否需要登录：是

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "id": "1",
    "username": "admin",
    "nickname": "系统管理员",
    "avatar": "http://localhost:8080/images/avatar/admin.jpg",
    "role": "ADMIN"
  }
}
```

### (3) 管理员退出

- 方法：POST
- 路径：`/api/admin/auth/logout`
- 是否需要登录：是

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

## 2 商品管理模块

### (1) 后台查询商品列表

- 方法：GET
- 路径：`/api/admin/products`

请求参数

- `title` 模糊查询，可选
- `categoryId` 可选
- `status` 商品状态，上架或下架，可选
- `pageNum`
- `pageSize`

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "total": 120,
    "list": [
      {
        "id": "1001",
        "title": "某品牌手机",
        "subTitle": "八核处理器 8G 内存",
        "price": 3999,
        "stock": 100,
        "categoryId": "2",
        "mainImage": "http://localhost:8080/images/product/p1.jpg",
        "status": "ON_SHELF",
        "createTime": "2025-12-01 10:00:00"
      }
    ],
    "pageNum": 1,
    "pageSize": 10
  }
}
```

### (2) 新增商品

- 方法：POST
- 路径：`/api/admin/products`

请求体

```json
{
  "title": "某品牌手机",
  "subTitle": "八核处理器 8G 内存",
  "description": "商品详情描述",
  "price": 3999,
  "stock": 100,
  "categoryId": "2",
  "mainImage": "http://localhost:8080/images/product/p1.jpg",
  "imageList": [
    "http://localhost:8080/images/product/p1.jpg",
    "http://localhost:8080/images/product/p2.jpg"
  ],
  "status": "ON_SHELF"
}
```

说明

- `mainImage` 和 `imageList` 建议均通过文件上传接口获取图片 URL 后填充

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "id": "1001"
  }
}
```

### (3) 编辑商品

- 方法：PUT
- 路径：`/api/admin/products/{id}`

请求体字段同新增商品，可选填需要修改的字段。

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

### (4) 删除商品

- 方法：DELETE
- 路径：`/api/admin/products/{id}`

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

### (5) 上架下架商品

- 方法：PUT
- 路径：`/api/admin/products/{id}/status`

请求体

```json
{
  "status": "ON_SHELF"
}
```

枚举

- `ON_SHELF` 上架
- `OFF_SHELF` 下架

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

## 3 分类管理模块

### (1) 查询分类列表

- 方法：GET
- 路径：`/api/admin/categories`

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": [
    {
      "id": "1",
      "name": "手机数码",
      "parentId": "0",
      "sortOrder": 1,
      "children": [
        {
          "id": "2",
          "name": "手机",
          "parentId": "1",
          "sortOrder": 1,
          "children": []
        }
      ]
    }
  ]
}
```

### (2) 新增分类

- 方法：POST
- 路径：`/api/admin/categories`

请求体

```json
{
  "name": "手机",
  "parentId": "1",
  "sortOrder": 1
}
```

说明

- 约定仅支持两级分类。`parentId` 为 `"0"` 表示一级分类；非零时表示其上级分类为对应的一级分类 ID，二级分类不再允许有子分类。

### (3) 编辑分类

- 方法：PUT
- 路径：`/api/admin/categories/{id}`

### (4) 删除分类

- 方法：DELETE
- 路径：`/api/admin/categories/{id}`

说明

- 删除前需要考虑是否允许删除有子分类或已关联商品的分类，可以简单地做“有子分类或商品时禁止删除”

## 4 订单管理模块

### (1) 后台订单列表查询

- 方法：GET
- 路径：`/api/admin/orders`

请求参数

- `orderNo` 可选
- `status` 可选
- `userId` 可选
- `pageNum`
- `pageSize`

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "total": 1,
    "list": [
      {
        "orderId": "5001",
        "orderNo": "202512010001",
        "userId": "1",
        "status": "PAID",
        "totalAmount": 7998,
        "createTime": "2025-12-01 11:00:00",
        "payTime": "2025-12-01 11:05:00"
      }
    ],
    "pageNum": 1,
    "pageSize": 10
  }
}
```

### (2) 后台订单详情查询

- 方法：GET
- 路径：`/api/admin/orders/{orderId}`

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "orderId": "5001",
    "orderNo": "202512010001",
    "status": "PAID",
    "totalAmount": 7998,
    "createTime": "2025-12-01 11:00:00",
    "payTime": "2025-12-01 11:05:00",
    "addressSnapshot": {
      "receiverName": "张三",
      "receiverPhone": "13800000000",
      "province": "安徽省",
      "city": "合肥市",
      "district": "蜀山区",
      "detailAddress": "某路某号"
    },
    "items": [
      {
        "productId": "1001",
        "productTitle": "某品牌手机",
        "productImage": "http://localhost:8080/images/product/p1.jpg",
        "price": 3999,
        "quantity": 2,
        "subtotalAmount": 7998
      }
    ]
  }
}
```

### (3) 修改订单状态

- 方法：PUT
- 路径：`/api/admin/orders/{orderId}/status`

请求体

```json
{
  "status": "SHIPPED",
  "remark": "已发货，快递公司顺丰"
}
```

说明

- 主要用于将 `PAID` 订单标记为 `SHIPPED`
- 可以在 `SHIPPED` 基础上，再变更为 `COMPLETED`
- 后台不可对已超时自动取消的订单直接改回 `WAIT_PAY`，可通过备注说明取消原因（例如系统自动取消）

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

# 四、认证与权限控制

## 1 登录态校验

- 用户端接口
  - `/api/auth/register`
  - `/api/auth/login`
  - `/api/products/**`
  - `/api/categories/**`
    这些接口允许匿名访问
- 其他 `/api/**` 接口均要求用户角色为普通用户，且需要在请求头中携带有效 Token，否则返回业务状态码 `40002`

## 2 管理员权限

- 所有 `/api/admin/**` 接口必须携带管理员角色的 Token
- 在网关过滤器或 Spring 拦截器中统一校验用户角色
- Token 缺失、非法、过期返回 `40002`
- Token 有效但角色非 `ADMIN` 返回 `40003`

# 五、日志与基础监控建议

在以下场景记录日志

- 登录、退出登录（记录用户名、IP、时间、是否成功）
- 新增订单、取消订单、支付模拟（记录订单编号、用户编号、金额、状态变化）
- 订单超时自动取消（记录订单编号、取消时间、取消原因）
- 后台商品新增、修改、删除、上架下架
- 后台更改订单状态

















