# 一、接口总体约定

## 1 请求基础约定

### (1) 接口风格

全部采用 REST 风格，统一使用 HTTP 方法：GET POST PUT DELETE OPTIONS

### (2) 请求头

- Content-Type：JSON 请求统一使用 `application/json`
  - 文件上传使用 `multipart/form-data`
- 认证请求头（需要登录的接口）：
  - 允许请求头 `Authorization Content-Type`
  - `Authorization` 传递 Token，例如：`Bearer xxxx.yyyy.zzzz`

### (3) 统一响应体

所有接口均返回统一结构：

```json
{
  "code": 0,
  "message": "成功",
  "data": {}
}
```

- code 仅当为 0 时表示成功
- code 非 0 表示失败
- 字段名 code message data 不得修改
- 实际业务数据必须放在 data 中
- 对于无业务数据的成功响应，data 可为 null，但字段必须存在

## 2 分页接口统一约定

分页接口统一返回：

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "total": 100,
    "list": [],
    "pageNum": 1,
    "pageSize": 10
  }
}
```

## 3 HTTP 状态码与业务错误码约定

### (1) HTTP 状态码

- 所有正常业务调用统一返回 HTTP 200
- 业务成功失败由 `code` 决定

### (2) 常用业务错误码

- 40001 参数校验失败
- 40002 未登录或登录已过期
- 40003 无权限
- 40004 库存不足
- 40400 资源不存在
- 50000 系统内部错误

失败响应必须为统一结构

```json
{
  "code": 40002,
  "message": "登录已过期，请重新登录",
  "data": null
}
```

## 4 时间与金额字段统一约定

### (1) 时间

- 所有对外时间字段统一使用 `yyyy-MM-dd HH:mm:ss`

### (2) 金额

- 所有金额字段单位为元。
- 接口响应数据类型必须为 **Number** (例如 `3999` 或 `3999.50`)，**禁止**返回字符串类型（例如 `"3999.00"`）
- 后端使用 BigDecimal 进行金额计算，向前端返回数值。
- 前端负责界面展示格式化（例如保留两位小数）

### (3) ID 与 Long 精度

- 后端对所有 Long/long 类型字段（例如 id、userId、orderId、productId、categoryId、bannerId、addressId、cartItemId 等）统一按 **字符串** 形式返回，避免前端 JavaScript 精度丢失。
- 请求侧允许传入数字或数字字符串；推荐使用数字字符串。
- 注意：金额字段仍按 **Number** 返回，不受此规则影响。

# 二、通用文件上传接口

为支持用户头像及商品图片上传，提供统一上传接口。

## 上传图片文件

- 接口名称：文件上传
- 方法：POST
- 路径：`/api/upload`
- 是否需要登录：否（当前实现已放行 `/api/upload`，用户与管理员均可直接调用）
- 请求方式：`multipart/form-data`

请求示例（表单字段）

- 字段名：`file`
- 类型：文件（单文件上传）


- 说明
  - 后端使用 MultipartFile 接收上传文件，保存到本地磁盘目录：`{user.dir}/data/upload/{yyyy}/{MM}/{dd}/`（按日期分目录）。
  - 对外访问前缀由配置 `jd.upload.public-prefix` 决定（默认 `/images`），上传接口返回的 `url` 形如：`/images/{yyyy}/{MM}/{dd}/{filename}`。
  - 静态资源映射由配置 `jd.upload.local-dir` 决定：`{public-prefix}/**` 映射到该物理目录。
  - 当前实现中，上传服务实际写入目录固定为 `{user.dir}/data/upload`，因此必须将 `jd.upload.local-dir` 配置为 `${user.dir}/data/upload`，才能保证 `/images/**` 可访问。
  - `fullUrl` 是否返回由配置 `jd.upload.return-full-url` 控制；若开启则按当前请求的 scheme、host、port 计算基础地址并拼接 `url`。
  - 业务表建议存储 `url`（相对路径）；响应侧当前实现以数据库保存值为准，未对所有图片字段做统一补全。

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "url": "/images/2025/12/01/abc.jpg",
    "fullUrl": "http://localhost:8080/images/2025/12/01/abc.jpg",
    "originalFilename": "abc.jpg"
  }
}
```

字段说明

- `url` 图片相对访问路径，建议在业务字段中使用该值存储。
- `fullUrl` 图片完整访问地址，前端可直接用于展示。
- `originalFilename` 原始文件名。

## 对外返回规则

- 业务表建议存储 `url`（相对路径），例如 `/images/2025/12/01/abc.jpg`
- 上传接口 `POST /api/upload` 总是返回 `url`；`fullUrl` 是否拼接基础地址由配置 `jd.upload.return-full-url` 控制：
  - 若开启且 `baseUrl` 非空：`fullUrl = baseUrl + url`
  - 若关闭或 `baseUrl` 为空：`fullUrl = url`
- 除下列“例外接口”外，所有图片相关字段在响应侧均直接返回数据库保存值（可能为相对路径，也可能为完整 URL），不做统一补全：
  - 管理端：`POST /api/admin/auth/login`、`GET /api/admin/auth/me` 会将 `user.avatar` 补全为 `fullUrl`
  - 用户端：`GET /api/orders/{orderId}` 会将订单明细 `items.productImage` 补全为 `fullUrl`
  - 用户端：`GET /api/orders`（订单列表）中的 `items.productImage` 不补全 `fullUrl`（保持数据库值）
  - 用户端：商品列表/商品详情接口中的 `mainImage/images` 不补全 `fullUrl`（保持数据库值）

## 后续接口字段约定

- 请求侧：`avatar`、`mainImage`、`productImage`、`imageList` 等字段允许传入上传接口返回的 `url` 或 `fullUrl`
- 后端当前不会统一裁剪/归一化，会按业务字段原样保存
- 响应侧：除“对外返回规则”中列出的例外接口外，均返回数据库中保存值。

# 三、用户端接口

## 1 账户与认证模块

### (1) 用户注册

- 接口名称：用户注册
- 方法：POST
- 路径：`/api/auth/register`
- 是否需要登录：否

请求体示例

```json
{
  "username": "tom",
  "password": "123456",
  "nickname": "hk",
  "avatar": "/images/avatar/avatar1.jpg"
}
```

请求字段说明

- `username` 用户名，必填，唯一
- `password` 密码，必填
- `nickname` 昵称，选填；若为空或仅空白字符，后端默认使用 username
- `avatar` 头像地址字符串，选填

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "userId": "1"
  }
}
```

### (2) 用户登录

- 接口名称：用户登录
- 方法：POST
- 路径：`/api/auth/login`
- 是否需要登录：否

请求体示例

```json
{
  "username": "tom",
  "password": "123456"
}
```

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "token": "xxxx.yyyy.zzzz",
    "expireAt": "2025-12-31 12:00:00",
    "user": {
      "id": "1",
      "username": "tom",
      "nickname": "hk",
      "avatar": "/images/avatar/avatar1.jpg",
      "role": "USER"
    }
  }
}
```

### (3) 获取当前登录用户信息

- 方法：GET
- 路径：`/api/auth/me`
- 是否需要登录：是

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "id": "1",
    "username": "tom",
    "nickname": "hk",
    "avatar": "http://localhost:8080/images/avatar/avatar1.jpg",
    "role": "USER"
  }
}
```

### (4) 退出登录

- 方法：POST
- 路径：`/api/auth/logout`
- 是否需要登录：是

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

## 2 商品模块

### （1）商品列表

- 请求方式：GET
- 路径：`/api/products`
- 是否需要登录：否

请求参数（Query）：
- keyword：关键词（可选）
- categoryId：分类ID（可选）
- sortField：排序字段（可选，示例：`price` / `createTime`）
- sortOrder：排序方向（可选，示例：`asc` / `desc`）
- pageNum：页码（必填）
- pageSize：每页条数（必填）

成功响应（分页 PageResult）：
```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "total": 2,
    "list": [
      {
        "id": "3",
        "title": "戴尔/外星人",
        "subTitle": "笔记本中的元神，你值得拥有！",
        "price": 64800.00,
        "stock": 648,
        "categoryId": "4",
        "mainImage": "/images/2025/12/14/demo.jpg"
      }
    ],
    "pageNum": 1,
    "pageSize": 10
  }
}
```

### (2) 商品详情

- 方法：GET
- 路径：`/api/products/{id}`
- 是否需要登录：否

路径参数：

- id：商品ID

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "id": "3",
    "title": "戴尔/外星人",
    "subTitle": "笔记本中的元神，你值得拥有！",
    "description": "......",
    "price": 64800.00,
    "stock": 648,
    "categoryId": "4",
    "images": [
      "/images/2025/12/14/a.jpg",
      "/images/2025/12/14/b.jpg"
    ]
  }
}

```

## 3 分类模块

### (1) 获取分类树

- 方法：GET
- 路径：`/api/categories/tree`
- 是否需要登录：否

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": [
    {
      "id": "10",
      "name": "手机数码",
      "parentId": "0",
      "sortOrder": 1,
      "children": [
        {
          "id": "11",
          "name": "手机",
          "parentId": "10",
          "sortOrder": 1,
          "children": []
        }
      ]
    }
  ]
}

```

## 4 购物车模块

### （1）查询购物车

- 请求方式：GET
- 路径：`/api/cart`
- 是否需要登录：是

成功响应（CartVO）：
```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "totalQuantity": 3,
    "totalAmount": 7998.00,
    "items": [
      {
        "cartItemId": "10",
        "productId": "3",
        "productTitle": "戴尔/外星人",
        "productImage": "/images/2025/12/14/demo.jpg",
        "price": 64800.00,
        "quantity": 1,
        "subtotalAmount": 64800.00
      }
    ]
  }
}
```

### （2）加入购物车

- 请求方式：POST
- 路径：`/api/cart/items`
- 是否需要登录：是

请求体：

```json
{
  "productId": "3",
  "quantity": 1
}
```

成功响应（返回新建 cartItemId）：

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "cartItemId": "10"
  }
}
```

### （3）修改购物车商品数量

- 请求方式：PUT
- 路径：`/api/cart/items/{cartItemId}`
- 是否需要登录：是

请求体：

```json
{
  "quantity": 2
}
```

成功响应（返回更新后的 CartVO）：

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "totalQuantity": 2,
    "totalAmount": 129600.00,
    "items": [
      {
        "cartItemId": "10",
        "productId": "3",
        "productTitle": "戴尔/外星人",
        "productImage": "/images/2025/12/14/demo.jpg",
        "price": 64800.00,
        "quantity": 2,
        "subtotalAmount": 129600.00
      }
    ]
  }
}
```

### （4）删除购物车单项

- 请求方式：DELETE
- 路径：`/api/cart/items/{cartItemId}`
- 是否需要登录：是

成功响应：

```json
{ 
    "code": 0, 
    "message": "成功", 
    "data": null 
}
```

### （5）批量删除购物车项

- 请求方式：DELETE
- 路径：`/api/cart/items`
- 是否需要登录：是

请求体（字段名为 ids）：

```json
{
  "ids": ["10", "11"]
}
```

成功响应：

```json
{ 
    "code": 0,
    "message": "成功", 
    "data": null 
}
```

> 说明：当前后端未实现 checked/全选相关接口与字段；如需勾选态，请前端自行维护或后续再扩展后端字段与接口。

## 5 订单模块

### (1) 创建订单

- 方法：POST
- 路径：`/api/orders`
- 是否需要登录：是

请求体示例（从购物车下单）

```json
{
  "sourceType": "CART",
  "cartItemIds": [
    "1",
    "2"
  ],
  "addressId": "10",
  "remark": "尽快发货"
}
```

请求体示例（立即购买）

```json
{
  "sourceType": "BUY_NOW",
  "productId": "1001",
  "quantity": 2,
  "addressId": "10",
  "remark": ""
}
```

请求字段说明

- `sourceType` 必填，枚举值：`CART`（购物车下单）、`BUY_NOW`（立即购买）

`sourceType=CART` 时

- cartItemIds addressId 必填

sourceType=BUY_NOW 时

- productId quantity addressId 必填

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "orderId": "5001"
  }
}
```

字段说明

- 创建订单接口当前仅返回 `orderId`。
- `expireTime` 等字段请通过订单详情接口查询。

### (2) 查询订单列表

- 方法：GET
- 路径：`/api/orders`
- 是否需要登录：是

请求参数

- `pageNum` 页码
- `pageSize` 每页条数
- - `status` 订单状态过滤（可选：WAIT_PAY / PAID / SHIPPED / COMPLETED / CANCELED）

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "total": 1,
    "list": [
      {
        "orderId": "5001",
        "orderNo": "202512010001",
        "status": "WAIT_PAY",
        "totalAmount": 7998,
        "createTime": "2025-12-01 11:00:00",
        "payTime": null,
        "items": [
          {
            "productId": "1001",
            "productTitle": "某品牌手机",
            "productImage": "/images/product/p1.jpg",
            "price": 3999,
            "quantity": 2,
            "subtotalAmount": 7998
          }
        ]
      }
    ],
    "pageNum": 1,
    "pageSize": 10
  }
}
```

说明

- 当订单处于 `WAIT_PAY` 且超过支付超时时间时，后端通过定时任务扫描自动将状态更新为 `CANCELED` 并回滚库存；取消原因写入 `SYSTEM_TIMEOUT`（详情接口可查询）
- 列表中的 `items[].productImage` 当前实现直接返回数据库保存的图片地址，列表接口不做 `fullUrl` 补全；如需完整 URL，请前端自行拼接后端域名，或改用订单详情接口返回值
- 列表响应仅包含与列表展示相关字段；`expireTime`、`cancelTime`、`cancelReason` 等字段请通过订单详情接口获取

### (3) 查询订单详情

- 方法：GET
- 路径：`/api/orders/{orderId}`
- 是否需要登录：是

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "orderId": "5001",
    "orderNo": "202512010001",
    "status": "WAIT_PAY",
    "totalAmount": 7998,
    "remark": null,
    "createTime": "2025-12-01 11:00:00",
    "payTime": null,
    "cancelTime": null,
    "cancelReason": null,
    "expireTime": "2025-12-01 11:15:00",
    "addressSnapshot": {
      "receiverName": "张三",
      "receiverPhone": "13800000000",
      "province": "安徽省",
      "city": "合肥市",
      "district": "蜀山区",
      "detailAddress": "某路某号"
    },
    "items": [
      {
        "productId": "1001",
        "productTitle": "某品牌手机",
        "productImage": "http://localhost:8080/images/product/p1.jpg",
        "price": 3999,
        "quantity": 2,
        "subtotalAmount": 7998
      }
    ]
  }
}
```

- `cancelReason`：取消原因
  - 用户调用取消接口时，写入请求体中的 `reason`；若未传则默认写入“用户主动取消”
  - 系统超时自动取消时，写入固定值 `SYSTEM_TIMEOUT`
- `items[].productImage`：订单详情接口会在响应组装阶段对图片地址做 `fullUrl` 补全（当数据库保存的是相对路径时）

### (4) 取消订单

- 方法：PUT
- 路径：`/api/orders/{orderId}/cancel`
- 是否需要登录：是

请求体示例

```json
{
  "reason": "不想要了"
}
```

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

说明

- 请求体可不传；若未传 `reason`，后端默认按“用户主动取消”处理并记录
- 只能取消待支付订单，已支付订单需走售后流程（暂不实现）
- 取消成功后库存回滚

### （5）支付订单

- 请求方式：POST
- 路径：`/api/orders/{orderId}/pay`
- 是否需要登录：是

说明：
- 该接口为“模拟支付”，不接收请求体。
- 后端将订单状态从“待支付”更新为“已支付”；若订单已超时被取消，则返回业务错误。

成功响应：
```json
{ 
    "code": 0,
    "message": "成功",
    "data": null 
}
```

## 6 收货地址模块

### (1) 新增收货地址

- 方法：POST
- 路径：`/api/addresses`
- 是否需要登录：是

请求体示例

```json
{
  "receiverName": "张三",
  "receiverPhone": "13800000000",
  "province": "安徽省",
  "city": "合肥市",
  "district": "蜀山区",
  "detailAddress": "某路某号",
  "isDefault": 1
}
```

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "id": "1"
  }
}
```

### (2) 地址列表

- 方法：GET
- 路径：`/api/addresses`
- 是否需要登录：是

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": [
    {
      "id": "10",
      "receiverName": "张三",
      "receiverPhone": "13800000000",
      "province": "安徽省",
      "city": "合肥市",
      "district": "蜀山区",
      "detailAddress": "某路某号",
      "isDefault": 1
    }
  ]
}
```

### (3) 修改地址

- 方法：PUT
- 路径：`/api/addresses/{addressId}`
- 是否需要登录：是

请求体示例

```json
{
  "receiverName": "李四",
  "receiverPhone": "13900000000",
  "province": "安徽省",
  "city": "合肥市",
  "district": "瑶海区",
  "detailAddress": "另一路某号",
  "isDefault": 0
}
```

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

### (4) 删除地址

- 方法：DELETE
- 路径：`/api/addresses/{addressId}`
- 是否需要登录：是

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

### (5) 设置默认地址

- 方法：PUT
- 路径：`/api/addresses/{addressId}/default`
- 是否需要登录：是

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

# 四、管理后台接口

## 1 管理员认证模块

### (1) 管理员登录

- 方法：POST
- 路径：`/api/admin/auth/login`

请求体

```json
{
  "username": "admin",
  "password": "123456"
}
```

说明

- 可以与用户表合并，通过 `role` 字段区分
- 登录成功后返回 token，与用户端相同机制

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "token": "xxxx.yyyy.zzzz",
    "expireAt": "2025-12-31 12:00:00",
    "user": {
      "id": "1",
      "username": "admin",
      "nickname": "系统管理员",
      "avatar": "http://localhost:8080/images/avatar/admin.jpg",
      "role": "ADMIN"
    }
  }
}
```

### (2) 获取当前管理员信息

- 方法：GET
- 路径：`/api/admin/auth/me`
- 是否需要登录：是

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "id": "1",
    "username": "admin",
    "nickname": "系统管理员",
    "avatar": "http://localhost:8080/images/avatar/admin.jpg",
    "role": "ADMIN"
  }
}
```

### (3) 管理员退出

- 方法：POST
- 路径：`/api/admin/auth/logout`
- 是否需要登录：是

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

## 2 商品管理模块（管理端）

### （1）创建商品

- 请求方式：POST
- 路径：`/api/admin/products`
- 是否需要登录：是（管理员）

请求体（status 示例：`ON_SHELF` / `OFF_SHELF`）：
```json
{
  "title": "戴尔/外星人",
  "subTitle": "笔记本中的元神，你值得拥有！",
  "description": "......",
  "price": 64800.00,
  "stock": 648,
  "categoryId": "4",
  "mainImage": "/images/2025/12/14/demo.jpg",
  "imageList": ["/images/2025/12/14/a.jpg", "/images/2025/12/14/b.jpg"],
  "status": "ON_SHELF"
}
```

成功响应（返回新建商品ID）：

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "id": "3"
  }
}
```

### （2）商品列表（管理端）

- 请求方式：GET
- 路径：`/api/admin/products`
- 是否需要登录：是（管理员）

请求参数（Query）：

- title：标题关键词（可选）
- categoryId：分类ID（可选）
- status 目标状态：`ON_SHELF`（上架）、`OFF_SHELF`（下架）
- pageNum：页码（必填）
- pageSize：每页条数（必填）

成功响应（分页 PageResult）：

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "total": 1,
    "list": [
      {
        "id": "3",
        "title": "戴尔/外星人",
        "subTitle": "笔记本中的元神，你值得拥有！",
        "price": 64800.00,
        "stock": 648,
        "categoryId": "4",
        "mainImage": "/images/2025/12/14/demo.jpg",
        "imageList": "/images/2025/12/14/a.jpg,/images/2025/12/14/b.jpg",
        "description": "......",
        "status": "ON_SHELF",
        "createTime": "2025-12-14 10:00:00"
      }
    ],
    "pageNum": 1,
    "pageSize": 10
  }
}
```

### (3) 修改商品

- 方法：PUT
- 路径：`/api/admin/products/{id}`
- 是否需要登录：是 (管理员)

请求体示例

```json
{
  "title": "某品牌手机(更新)",
  "subTitle": "旗舰新品",
  "description": "更新后的描述",
  "price": 3999,
  "stock": 99,
  "categoryId": "10",
  "mainImage": "http://localhost:8080/images/product/p1.jpg",
  "imageList": [
    "http://localhost:8080/images/product/p1.jpg"
  ],
  "status": "ON_SHELF"
}
```

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

### (4) 删除商品

- 方法：DELETE
- 路径：`/api/admin/products/{id}`
- 是否需要登录：是 (管理员)

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

### (5) 修改商品状态

- 方法：PUT
- 路径：`/api/admin/products/{id}/status`
- 是否需要登录：是 (管理员)

请求体

```json
{
  "status": "OFF_SHELF"
}
```

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

## 3 分类管理模块

### （1）获取分类树（管理端）

- 请求方式：GET
- 路径：`/api/admin/categories`
- 是否需要登录：是（管理员）

成功响应：
```json
{
  "code": 0,
  "message": "成功",
  "data": [
    {
      "id": "1",
      "name": "手机数码",
      "parentId": "0",
      "sortOrder": 1,
      "children": []
    }
  ]
}
```

### (2) 新增分类

- 方法：POST
- 路径：`/api/admin/categories`
- 是否需要登录：是 (管理员)

请求体示例

```json
{
  "name": "手机数码",
  "parentId": "0",
  "sortOrder": 1
}
```

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

### (3) 修改分类

- 方法：PUT
- 路径：`/api/admin/categories/{id}`
- 是否需要登录：是 (管理员)

请求体示例

```json
{
  "name": "手机数码(更新)",
  "parentId": "0",
  "sortOrder": 2
}
```

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

### (4) 删除分类

- 方法：DELETE
- 路径：`/api/admin/categories/{id}`
- 是否需要登录：是 (管理员)

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

说明

- 当前实现：若分类存在子分类则禁止删除，并返回参数错误 `40001`。
- 是否检查“已关联商品”当前未实现；如需约束可后续补充。

## 4 订单管理模块

### (1) 订单分页列表

- 方法：GET
- 路径：`/api/admin/orders`
- 是否需要登录：是 (管理员)

请求参数

- `pageNum` 页码
- `pageSize` 每页条数
- `status` 订单状态过滤（可选：WAIT_PAY / PAID / SHIPPED / COMPLETED / CANCELED）
- `userId` 用户 ID（可选，精确匹配）
- `orderNo` 订单号（可选，模糊匹配）

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "total": 1,
    "list": [
      {
        "orderId": "5001",
        "orderNo": "202512010001",
        "status": "WAIT_PAY",
        "totalAmount": 7998,
        "createTime": "2025-12-01 11:00:00",
        "payTime": null,
        "userId": "1"
      }
    ],
    "pageNum": 1,
    "pageSize": 10
  }
}
```

当前实现：管理端订单列表仅返回 `userId`，不返回 `username`；如需展示用户名，请在前端通过用户信息接口二次查询，或后续扩展订单列表 VO 增加并回填该字段。

当订单处于 `WAIT_PAY` 且超过支付超时时间时，后端定时任务会自动将状态更新为 `CANCELED` 并回滚库存；前端刷新列表即可看到状态变化。

列表响应仅包含与列表展示相关字段；`expireTime`、`cancelTime`、`cancelReason` 等字段请通过订单详情接口获取。

### (2) 管理端订单详情

- 方法：GET
- 路径：`/api/admin/orders/{orderId}`
- 是否需要登录：是 (管理员)

响应示例略

### (3) 修改订单状态

- 方法：PUT
- 路径：`/api/admin/orders/{orderId}/status`
- 是否需要登录：是 (管理员)

请求体

```json
{
  "status": "SHIPPED",
  "remark": "已安排发货"
}
```

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

字段说明

- status：必填。可选值：`WAIT_PAY、PAID、SHIPPED、COMPLETED、CANCELED`
- remark：选填。用于管理员备注，不传则不修改原备注

状态流转约束（与当前实现一致）

- 若当前状态为 `PAID`，仅允许更新为 `SHIPPED`
- 若当前状态为 `SHIPPED`，仅允许更新为 `COMPLETED`
- 若当前状态为 `CANCELED`，不允许改回 `WAIT_PAY`
- 说明：该接口仅修改订单状态与备注，不会自动设置 `payTime`；模拟支付请调用用户端 `POST /api/orders/{orderId}/pay`

## 5 轮播图管理模块 管理员

### (1) 分页轮播图列表

- **接口名称**：分页轮播图列表
- **方法**：GET
- **路径**：`/api/admin/banners`
- **是否需要登录**：是 (管理员)

请求参数

- pageNum pageSize

响应示例

```json
{
  "code": 0,
  "message": "成功",
  "data": {
    "total": 2,
    "list": [
      {
        "id": "1",
        "imgUrl": "/images/2023/10/banner1.jpg",
        "redirectUrl": "/products/1",
        "sortOrder": 1,
        "status": 1,
        "createTime": "2023-10-27 10:00:00"
      },
      {
        "id": "2",
        "imgUrl": "/images/2023/10/banner2.jpg",
        "redirectUrl": "https://www.google.com",
        "sortOrder": 2,
        "status": 0,
        "createTime": "2023-10-28 12:00:00"
      }
    ],
    "pageNum": 1,
    "pageSize": 10
  }
}
```

### (2) 新增轮播图

- **接口名称**：新增轮播图
- **方法**：POST
- **路径**：`/api/admin/banners`
- **是否需要登录**：是 (管理员)

**请求 Body**

```json
{
  "imgUrl": "https://example.com/new-banner.jpg",
  "redirectUrl": "/products/1002",
  "sortOrder": 3,
  "status": 1
}
```

**字段说明**

- `imgUrl`: (必填) 图片地址，可以是完整 URL 或上传接口返回的相对路径。
- `redirectUrl`: (可选) 点击跳转地址。站内链接建议以 `/` 开头，站外链接需带 `http`。
- `sortOrder`: (必填) 排序值，数值越小越靠前。
- `status`: (可选) 1-启用，0-禁用。默认 1。

**响应示例**

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

### (3) 修改轮播图

- **接口名称**：修改轮播图信息
- **方法**：PUT
- **路径**：`/api/admin/banners/{id}`
- **是否需要登录**：是 (管理员)

**请求参数**

- 路径参数 `id`: 轮播图 ID

**请求 Body**

```json
{
  "imgUrl": "https://example.com/updated-banner.jpg",
  "redirectUrl": "",
  "sortOrder": 5,
  "status": 1
}
```

**响应示例**

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

### (4) 删除轮播图

- **接口名称**：删除轮播图
- **方法**：DELETE
- **路径**：`/api/admin/banners/{id}`
- **是否需要登录**：是 (管理员)

**请求参数**

- 路径参数 `id`: 轮播图 ID

**响应示例**

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

### (5) 修改轮播图状态

- **接口名称**：快速启用/禁用
- **方法**：PUT
- **路径**：`/api/admin/banners/{id}/status`
- **是否需要登录**：是 (管理员)

**请求参数**

- 路径参数 `id`: 轮播图 ID

**请求 Body**

```json
{
  "status": 0
}
```

- `status`: 目标状态 (1-启用, 0-禁用)

**响应示例**

```json
{
  "code": 0,
  "message": "成功",
  "data": null
}
```

# 五、认证与权限控制

## 1 登录态校验

- 允许匿名访问的接口（白名单）
  - `/api/auth/register`
  - `/api/auth/login`
  - `/api/products/**`
  - `/api/categories/**`
  - `/api/banners`
  - `/api/upload`
- 除白名单外的 `/api/**` 接口均需要在请求头中携带有效 Token
  - Token 缺失、非法或过期返回 `40002`
- `/api/admin/**` 管理端接口还需要管理员角色
  - Token 有效但角色非 `ADMIN` 返回 `40003`

## 2 管理员权限

- 所有 `/api/admin/**` 接口必须携带管理员角色的 Token
- 在网关过滤器或 Spring 拦截器中统一校验用户角色
- Token 缺失、非法、过期返回 `40002`
- Token 有效但角色非 `ADMIN` 返回 `40003`

# 六、日志与基础监控建议

在以下场景记录日志

- 登录、退出登录（记录用户名、IP、时间、是否成功）
- 新增订单、取消订单、支付模拟（记录订单编号、用户编号、金额、状态变化）
- 订单超时自动取消（记录订单编号、取消时间、取消原因）
- 后台商品新增、修改、删除、上架下架
- 后台更改订单状态











​	
