# 仿京东在线商城系统

# 一. 项目模块

## 用户端模块

### 账户与认证模块

功能:注册、登录、退出登录、获取当前用户信息

需求:

a 登录注册接口(账号密码即可,暂时不需要做短信登录)

b 基于 JWT 或 Redis 的登录态管理

c 简单的密码加密存储（例如使用 BCrypt）

d 获取当前用户信息接口，用于前端展示头像、昵称等

e 用户头像上传采用“先上传文件、再保存图片地址”的方式。前端通过文件上传接口获取头像图片地址字符串（相对路径或完整 URL），再随注册或修改资料接口一起提交。

### 商品浏览与搜索模块

对应京东的商品列表页、商品详情页

需求：

a 按分类分页浏览商品

b 支持关键字搜索（按商品标题、关键字模糊匹配即可）

c 查询商品详情（基本信息、图片、价格、库存就够了）

d 简单排序（可以按价格升降序、按上架时间排序就行）

e 商品详情中支持多图展示，图片地址统一来源于后端文件上传接口返回的 URL。

f 当用户在前端页面选择一级分类（例如“数码”）时，应能看到该一级分类下所有二级分类商品的聚合列表，后端在处理分类筛选时需要支持按照一级分类ID自动包含其下所有二级分类的商品。

###  购物车模块

对应京东加购物车、查看购物车。
需求：

a 添加商品到购物车（可以指定添加数量）

b 修改购物车中商品数量（用户在购物车中增加某个商品的数量时，系统需要实时校验库存，若超过当前库存则应阻止操作并给出提示，避免用户在结算时才发现库存不足。）

c 删除购物车中的某条记录(支持批量删除)

d 查询当前用户的购物车列表，返回总数量和总金额

e 修改购物车商品数量接口在成功后返回最新的购物车汇总信息（包括每条明细、总数量和总金额），避免前端再发起一次列表查询请求，提升交互体验。

数据可以放在 Redis 或数据库，先放数据库实现

### 订单模块

关键!
需求：
a 从购物车或“立即购买”生成订单a 从购物车或“立即购买”生成订单

b 订单状态流转（待支付、已支付、已取消、已发货等）

c 查询订单列表、订单详情

d 支持取消订单（撤销前检查状态）

e 生成订单时扣减库存，保证基本的一致性（使用事务）

f 订单超时自动取消机制。下单成功后，如果在设定时间内（例如 15 分钟，测试阶段可只用20s左右）仍未支付，则系统自动将订单状态从“待支付”变更为“已取消”，同时回滚已扣减的库存。该逻辑由后端定时任务或延迟队列实现，前端无需单独页面，但需要在订单列表和详情中正确展示状态变化。前端可根据订单创建时间和超时时间，在“待支付”状态下展示支付倒计时，也可以在用户刷新页面时被动看到订单状态已经变更为“已取消”。

g 订单创建时需对当前选择的收货地址进行快照存储，将收货人姓名、联系电话、省市区及详细地址等字段复制保存到订单记录中，不应仅保存地址ID，以防用户后续在地址管理中修改或删除地址影响历史订单的展示与查询。

### 收货地址模块

需求：

a 新增、修改、删除收货地址

b 设置默认收货地址

c 下单时选择某个地址

### 支付结果模拟模块

不接入真实支付，只做“支付成功”模拟接口
需求：
a 用户调用“模拟支付成功”接口后，订单状态变为已支付

b 可记录一个支付时间字段

c 对于已超时自动取消的订单，支付模拟接口应禁止再次支付，防止状态错乱。

这部分更多是为了把订单状态闭环打通

## 管理后台模块

这个可以只做接口，用 Postman 或一个简单的管理页面即可

### 后台登录模块

与前台登录类似，但使用管理员账号；可以和用户表合并，用角色字段区分。

### 商品管理模块

需求：
a 新增、编辑、删除商品

b 上架、下架商品

c 支持上传商品主图和商品轮播图。上传流程采用“先通过文件上传接口上传图片文件，后端保存到本地静态资源目录并返回图片访问 URL，前端再把该 URL 作为 mainImage 或 imageList 字段提交”的模式。早期调试阶段可以暂时手动填写图片地址，但正式演示时应通过上传接口完成一整套流程。

### 分类管理模块

需求：
a 新增、编辑、删除分类

b 父子分类结构。本项目业务上约定分类层级固定为两级，即“一级分类–二级分类”结构，不支持无限级嵌套。前端在分类选择（如级联选择器）中只需要处理两层结构，后端在分类管理时也应限制最大层级为 2（parentId 为 0 的为一级分类，其子节点为二级分类，二级分类不再允许有子分类）。

### 订单管理模块

需求：
a 管理员查看所有订单列表、按状态筛选

b 修改订单状态（例如标记为已发货）

c 能查看并区分“用户主动取消”和“系统超时自动取消”的订单，便于在演示时说明业务逻辑（可以通过取消原因、备注或日志体现）。

## 系统支撑模块

### 统一响应与异常处理

需求：
a 定义统一返回结构类，例如 Result<T>

b 全局异常处理，统一转换为标准响应格式

c 约定统一业务状态码，例如：
  0 成功
  40001 参数校验失败
  40002 未登录或登录已过期
  40003 无权限访问
  40400 资源不存在
  50000 系统内部错误

d 当请求未携带 Token、Token 非法或 Token 已过期时，统一返回业务状态码 40002，由前端统一拦截并跳转到登录页或清理本地登录态，避免出现返回 500 等不明确错误。

### 认证与权限控制

需求：
a 登录态校验拦截器或过滤器

b 区分用户和管理员角色，对后台接口做简单权限控制

c 所有需要登录的接口在未通过认证时均返回统一的业务状态码 40002，并在 message 中给出简要提示信息，方便前端统一处理。

### 文件上传与静态资源管理

需求：
a 提供统一的文件上传能力，支持用户头像、商品主图及轮播图等图片上传。后端使用 Multipart 请求接收文件，保存到本地磁盘指定目录（例如 static/images/），并通过 Spring MVC 静态资源映射对外暴露访问路径。

b 约定统一上传接口（例如 POST /api/upload），前端通过该接口上传文件，接收返回的图片访问 URL（相对路径或完整 URL），然后在业务接口中使用该 URL 填充 avatar、mainImage、imageList 等字段。

c 为避免与真实线上环境复杂的对象存储集成，本项目中仅需在本地开发环境完成静态资源目录映射，确保演示时上传图片后可以立即在页面中预览。

### 跨域与本地开发支持

为支持前后端本地分离开发，后端服务需统一配置跨域资源共享（CORS）策略，允许前端开发环境所在的域名与端口（ <http://localhost:5173> 或 [http://localhost:8080）通过浏览器访问后端接口。开发阶段可简化为允许指定来源或允许全部来源（如]() allowedOrigins="*"），上线时再根据实际部署环境收紧策略。前端如使用代理转发也应确保与后端 CORS 配置相匹配，避免出现跨域访问被浏览器拦截的情况。

### ID 设计与前后端传输约定

需求：
a 后端统一使用长整型 ID（例如数据库主键为 BIGINT，可使用自增 ID 或雪花算法等生成策略），保证在数据库层面 ID 的唯一性。

b 为避免 JavaScript 在处理超过 16 位长整型数字时出现精度丢失问题，所有对前端暴露的接口在返回 ID 字段时统一序列化为字符串类型。包括用户 ID、商品 ID、分类 ID、购物车条目 ID、订单 ID 等。

c 前端在处理所有 ID 字段时，一律按照字符串进行存储和传递，不在浏览器端对 ID 做数值运算，从而保证后端查询和更新操作的准确性。

### 日志与基础监控

需求：
a 在关键操作处记录日志（例如用户登录、下单、支付、订单取消、订单超时自动取消、后台商品新增或修改等）

b 日志中应包含必要的上下文信息（时间、用户、订单号、操作类型、结果等），方便排查问题和演示系统运行过程